<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur et Explication du Calcul de l'ICCP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Soft Corporate Teal -->
    <!-- Application Structure Plan: The application is designed as an interactive dashboard and explainer. It starts with a high-level summary of the final ICCP amount. It then breaks down the calculation into two distinct, collapsible sections: "ICCP 1 (Reliquat)" and "ICCP 2 (Acquisition en cours)". This separation clarifies the two different periods of rights. The most complex part, the accrual calculation for ICCP 2, features an interactive toggle allowing users to compare the "simple" monthly method with the more precise "√©quitable" method based on 4-week periods, demonstrating why the latter is more favorable. Each calculation step visually compares the 'Maintien' and '1/10e' methods side-by-side using cards and a bar chart, highlighting the most advantageous result. This structure was chosen to transform a static report into a dynamic learning tool, guiding the user from the final result down to the detailed legal justifications, which improves comprehension and engagement. -->
    <!-- Visualization & Content Choices: 
        - Key Metrics (e.g., total ICCP, days to pay): Displayed in prominent "stat cards" for immediate clarity (Goal: Inform, Method: HTML/CSS).
        - Maintien vs. 1/10e Comparison: Presented in side-by-side cards and reinforced with a simple Bar Chart from Chart.js for each ICCP period. This visual comparison makes it easy to see which method is more favorable (Goal: Compare, Method: HTML/CSS + Chart.js/Canvas).
        - Accrual Method Explanation: An interactive toggle button group allows users to switch between the "simple" and "√©quitable" calculation for days accrued in period N. This dynamic element directly demonstrates the impact of the legal rule of equivalence (Goal: Explain/Organize, Method: JS interaction updating text blocks).
        - Final Summary: A clear, non-interactive summary block adds the two ICCP components to show the total (Goal: Inform, Method: HTML/CSS).
        - Legal Explanations (e.g., sums to reintegrate): Placed in an expandable details/summary section to provide context without cluttering the main view (Goal: Inform, Method: HTML).
        - All choices adhere to the NO SVG/Mermaid constraint. The structure is designed to be explorable rather than a linear document. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .favorable {
            border: 2px solid #10b981; /* green-500 */
            box-shadow: 0 10px 15px -3px rgb(16 185 129 / 0.2), 0 4px 6px -4px rgb(16 185 129 / 0.2);
        }
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            max-width: 500px;
            margin: 1rem auto 0 auto;
        }
        details > summary {
            cursor: pointer;
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        .toggle-btn {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
            border: 1px solid #cbd5e1; /* slate-300 */
        }
        .toggle-btn.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            border-color: #0d9488; /* teal-600 */
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-6xl">

        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Simulateur d'Indemnit√© de Cong√©s Pay√©s (ICCP)</h1>
            <p class="mt-2 text-lg text-slate-600">Bas√© sur un cas de d√©part au 28 f√©vrier N.</p>
        </header>

        <main>
            <!-- Section R√©sultat Final -->
            <section id="summary" class="card mb-8">
                <h2 class="text-2xl font-bold text-center text-teal-700 mb-4">Montant Total de l'ICCP √† Verser</h2>
                <div class="text-5xl font-extrabold text-center text-slate-900 tracking-tight" id="total-iccp"></div>
                <p class="text-center text-slate-500 mt-2">Ce montant est la somme des indemnit√©s calcul√©es pour les deux p√©riodes de droits, en retenant toujours la m√©thode la plus favorable √† la salari√©e.</p>
            </section>

            <!-- Sections de Calcul D√©taill√© -->
            <div class="space-y-8">

                <!-- ICCP 1: Reliquat N-1 -->
                <details class="card" open>
                    <summary class="flex justify-between items-center font-bold text-xl text-slate-900">
                        <span>
                            <span class="text-teal-600">√âtape 1:</span> Calcul de l'ICCP pour le Reliquat N-1
                        </span>
                        <span class="text-2xl transform transition-transform duration-300 open:rotate-90 text-slate-400">&blacktriangleright;</span>
                    </summary>
                    <div class="mt-4 pt-4 border-t border-slate-200">
                        <p class="mb-4 text-slate-600">Cette premi√®re partie concerne l'indemnisation des <strong class="font-semibold text-slate-800" id="reliquat-days"></strong> jours de cong√©s acquis sur la p√©riode N-1 mais non pris par la salari√©e.</p>
                        <div class="grid md:grid-cols-2 gap-6 items-start">
                            <div id="iccp1-maintien-card" class="card">
                                <h3 class="font-bold text-lg">‚öñÔ∏è M√©thode du Maintien de Salaire</h3>
                                <p class="text-sm text-slate-500">Salaire qui aurait √©t√© per√ßu.</p>
                                <p class="text-2xl font-bold my-2" id="iccp1-maintien-amount"></p>
                                <p class="text-xs text-slate-500" id="iccp1-maintien-formula"></p>
                            </div>
                            <div id="iccp1-dixieme-card" class="card">
                                <h3 class="font-bold text-lg">üî¢ R√®gle du Dixi√®me (1/10e)</h3>
                                <p class="text-sm text-slate-500">10% du brut annuel de r√©f√©rence.</p>
                                <p class="text-2xl font-bold my-2" id="iccp1-dixieme-amount"></p>
                                <p class="text-xs text-slate-500" id="iccp1-dixieme-formula"></p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="iccp1Chart"></canvas>
                        </div>
                        <div class="mt-6 p-4 bg-teal-50 border border-teal-200 rounded-lg text-center">
                            <p class="font-semibold text-teal-800">Conclusion pour l'ICCP 1 : Le <strong id="iccp1-favorable-method"></strong> est plus avantageux. Le montant retenu est de <strong id="iccp1-favorable-amount"></strong>.</p>
                        </div>
                    </div>
                </details>

                <!-- ICCP 2: Acquisition N -->
                <details class="card" open>
                    <summary class="flex justify-between items-center font-bold text-xl text-slate-900">
                        <span>
                            <span class="text-teal-600">√âtape 2:</span> Calcul de l'ICCP pour la P√©riode en Cours (N)
                        </span>
                        <span class="text-2xl transform transition-transform duration-300 open:rotate-90 text-slate-400">&blacktriangleright;</span>
                    </summary>
                    <div class="mt-4 pt-4 border-t border-slate-200">
                        <div class="card mb-6 bg-slate-50">
                            <h3 class="font-bold text-lg mb-3">A. D√©termination des jours √† payer : La R√®gle d'√âquivalence</h3>
                            <p class="text-slate-600 mb-4">Pour un d√©part en cours d'ann√©e, la loi (Art. L3141-4 C. trav.) permet de calculer les droits de mani√®re plus pr√©cise qu'avec la simple m√©thode mensuelle. Comparez les deux approches :</p>
                            <div class="flex justify-center space-x-2 mb-4">
                                <button id="toggle-equitable" class="toggle-btn active">M√©thode √âquitable (par 4 semaines)</button>
                                <button id="toggle-simple" class="toggle-btn">M√©thode Simple (par mois)</button>
                            </div>
                            <div id="explanation-box" class="p-4 bg-white rounded-md border border-slate-200 transition-all duration-300">
                                <!-- Contenu dynamique JS -->
                            </div>
                        </div>

                        <div class="mb-4 text-slate-600">
                            <p>Nous calculons maintenant l'indemnit√© pour les <strong class="font-semibold text-slate-800" id="acquisition-days"></strong> jours acquis sur la p√©riode en cours (du 01/06/N-1 au 28/02/N).</p>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6 items-start">
                             <div id="iccp2-maintien-card" class="card">
                                <h3 class="font-bold text-lg">‚öñÔ∏è M√©thode du Maintien de Salaire</h3>
                                <p class="text-sm text-slate-500">Salaire qui aurait √©t√© per√ßu.</p>
                                <p class="text-2xl font-bold my-2" id="iccp2-maintien-amount"></p>
                                <p class="text-xs text-slate-500" id="iccp2-maintien-formula"></p>
                            </div>
                            <div id="iccp2-dixieme-card" class="card">
                                <h3 class="font-bold text-lg">üî¢ R√®gle du Dixi√®me (1/10e)</h3>
                                <p class="text-sm text-slate-500">10% du brut annuel de r√©f√©rence.</p>
                                <p class="text-2xl font-bold my-2" id="iccp2-dixieme-amount"></p>
                                <p class="text-xs text-slate-500" id="iccp2-dixieme-formula"></p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="iccp2Chart"></canvas>
                        </div>
                        <div class="mt-6 p-4 bg-teal-50 border border-teal-200 rounded-lg text-center">
                            <p class="font-semibold text-teal-800">Conclusion pour l'ICCP 2 : Le <strong id="iccp2-favorable-method"></strong> est plus avantageux. Le montant retenu est de <strong id="iccp2-favorable-amount"></strong>.</p>
                        </div>
                    </div>
                </details>

                <!-- Section Explicative -->
                <details class="card">
                     <summary class="flex justify-between items-center font-bold text-xl text-slate-900">
                        <span>
                            <span class="text-teal-600">Pour aller plus loin:</span> La Base de Calcul du 1/10e
                        </span>
                        <span class="text-2xl transform transition-transform duration-300 open:rotate-90 text-slate-400">&blacktriangleright;</span>
                    </summary>
                    <div class="mt-4 pt-4 border-t border-slate-200 prose max-w-none text-slate-600">
                        <p>La base de calcul pour la r√®gle du dixi√®me (ici, <strong>25 000,00 ‚Ç¨</strong>) est cruciale. Selon l'Article L3141-24 du Code du travail, elle doit inclure toutes les sommes ayant le caract√®re de salaire per√ßues pendant la p√©riode de r√©f√©rence.</p>
                        <div class="grid md:grid-cols-2 gap-4 mt-4">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-semibold text-green-800">‚úÖ Sommes √† R√âINT√âGRER</h4>
                                <ul class="list-disc list-inside mt-2 space-y-1">
                                    <li>Salaire de base brut</li>
                                    <li>Heures suppl√©mentaires et leurs majorations</li>
                                    <li>Primes li√©es au travail (objectif, rendement, assiduit√©, 13√®me mois...)</li>
                                    <li>Avantages en nature (logement, nourriture)</li>
                                </ul>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <h4 class="font-semibold text-red-800">‚ùå Sommes √† EXCLURE</h4>
                                <ul class="list-disc list-inside mt-2 space-y-1">
                                    <li>Remboursements de frais professionnels (transport, repas)</li>
                                    <li>Primes exceptionnelles non li√©es au travail (ex: prime de mariage)</li>
                                    <li>Indemnit√©s de rupture du contrat</li>
                                    <li>L'indemnit√© de cong√©s pay√©s de l'ann√©e pr√©c√©dente</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </main>

        <footer class="text-center mt-12 text-sm text-slate-500">
            <p>Ce simulateur est un outil p√©dagogique bas√© sur les donn√©es de l'exercice fourni. Il ne remplace pas un bulletin de paie officiel.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const data = {
                salaireRef: 2250.00,
                baseDixieme: 25000.00,
                diviseurOuvrables: 26,
                joursAcquisAnnuels: 30,
                reliquatJoursN1: 6,
                joursTravaillesN: 273,
            };

            const formatCurrency = (value) => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(value);

            let acquisitionMode = 'equitable'; // 'equitable' or 'simple'

            const charts = {};

            function createChart(canvasId, labels, data) {
                const ctx = document.getElementById(canvasId).getContext('2d');
                if (charts[canvasId]) {
                    charts[canvasId].destroy();
                }
                charts[canvasId] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Montant en ‚Ç¨',
                            data: data,
                            backgroundColor: ['#64748b', '#334155'], // slate-500, slate-700
                            borderColor: ['#94a3b8', '#475569'], // slate-400, slate-600
                            borderWidth: 1,
                            borderRadius: 5,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 500,
                            easing: 'easeInOutQuad'
                        }
                    }
                });
            }

            function updateExplanationBox(joursAcquis, joursArrondis) {
                const box = document.getElementById('explanation-box');
                if (acquisitionMode === 'equitable') {
                    box.innerHTML = `
                        <p class="font-semibold text-slate-800">Calcul par P√©riodes de 4 Semaines (28 jours)</p>
                        <p class="text-sm text-slate-600">Cette m√©thode plus pr√©cise est bas√©e sur le temps de travail r√©el.</p>
                        <p class="text-sm text-slate-500 mt-2 font-mono bg-slate-100 p-2 rounded">(${data.joursTravaillesN} jours / 28) x 2.5 = <strong>${joursAcquis.toFixed(2)} jours</strong></p>
                        <p class="mt-2 text-sm text-slate-700">La loi impose l'arrondi √† l'entier sup√©rieur, soit <strong class="text-teal-700 font-bold">${joursArrondis} jours</strong>.</p>
                    `;
                } else {
                    box.innerHTML = `
                        <p class="font-semibold text-slate-800">Calcul par Mois Complets</p>
                        <p class="text-sm text-slate-600">Une m√©thode simple, mais souvent moins favorable.</p>
                        <p class="text-sm text-slate-500 mt-2 font-mono bg-slate-100 p-2 rounded">9 mois x 2.5 = <strong>${joursAcquis.toFixed(2)} jours</strong></p>
                        <p class="mt-2 text-sm text-slate-700">La loi impose l'arrondi √† l'entier sup√©rieur, soit <strong class="text-teal-700 font-bold">${joursArrondis} jours</strong>.</p>
                    `;
                }
            }
            
            function updateUI() {
                // ICCP 1 - Reliquat
                const joursReliquat = data.reliquatJoursN1;
                document.getElementById('reliquat-days').textContent = `${joursReliquat} jours`;

                const maintien1 = (data.salaireRef / data.diviseurOuvrables) * joursReliquat;
                const dixieme1 = (data.baseDixieme * 0.10 / data.joursAcquisAnnuels) * joursReliquat;

                document.getElementById('iccp1-maintien-amount').textContent = formatCurrency(maintien1);
                document.getElementById('iccp1-maintien-formula').textContent = `(${formatCurrency(data.salaireRef)} / ${data.diviseurOuvrables}) x ${joursReliquat} jours`;
                document.getElementById('iccp1-dixieme-amount').textContent = formatCurrency(dixieme1);
                document.getElementById('iccp1-dixieme-formula').textContent = `(${formatCurrency(data.baseDixieme)} x 10% / ${data.joursAcquisAnnuels}) x ${joursReliquat} jours`;
                
                const favorable1 = Math.max(maintien1, dixieme1);
                const favorableMethod1 = maintien1 > dixieme1 ? 'Maintien' : 'Dixi√®me';

                document.getElementById('iccp1-favorable-method').textContent = favorableMethod1;
                document.getElementById('iccp1-favorable-amount').textContent = formatCurrency(favorable1);
                
                document.getElementById('iccp1-maintien-card').classList.toggle('favorable', maintien1 >= dixieme1);
                document.getElementById('iccp1-dixieme-card').classList.toggle('favorable', dixieme1 > maintien1);
                
                createChart('iccp1Chart', ['Maintien', 'Dixi√®me'], [maintien1, dixieme1]);


                // ICCP 2 - Acquisition
                let joursAcquisN, joursArrondisN;
                if(acquisitionMode === 'equitable') {
                    joursAcquisN = (data.joursTravaillesN / 28) * 2.5;
                    joursArrondisN = Math.ceil(joursAcquisN);
                } else {
                    joursAcquisN = 9 * 2.5;
                    joursArrondisN = Math.ceil(joursAcquisN);
                }
                
                updateExplanationBox(joursAcquisN, joursArrondisN);
                document.getElementById('acquisition-days').textContent = `${joursArrondisN} jours`;

                const maintien2 = (data.salaireRef / data.diviseurOuvrables) * joursArrondisN;
                const dixieme2 = (data.baseDixieme * 0.10 / data.joursAcquisAnnuels) * joursArrondisN;

                document.getElementById('iccp2-maintien-amount').textContent = formatCurrency(maintien2);
                document.getElementById('iccp2-maintien-formula').textContent = `(${formatCurrency(data.salaireRef)} / ${data.diviseurOuvrables}) x ${joursArrondisN} jours`;
                document.getElementById('iccp2-dixieme-amount').textContent = formatCurrency(dixieme2);
                document.getElementById('iccp2-dixieme-formula').textContent = `(${formatCurrency(data.baseDixieme)} x 10% / ${data.joursAcquisAnnuels}) x ${joursArrondisN} jours`;
                
                const favorable2 = Math.max(maintien2, dixieme2);
                const favorableMethod2 = maintien2 > dixieme2 ? 'Maintien' : 'Dixi√®me';

                document.getElementById('iccp2-favorable-method').textContent = favorableMethod2;
                document.getElementById('iccp2-favorable-amount').textContent = formatCurrency(favorable2);
                
                document.getElementById('iccp2-maintien-card').classList.toggle('favorable', maintien2 >= dixieme2);
                document.getElementById('iccp2-dixieme-card').classList.toggle('favorable', dixieme2 > maintien2);

                createChart('iccp2Chart', ['Maintien', 'Dixi√®me'], [maintien2, dixieme2]);


                // Total
                const totalIccp = favorable1 + favorable2;
                document.getElementById('total-iccp').textContent = formatCurrency(totalIccp);
            }

            // Event Listeners for toggle
            const btnEquitable = document.getElementById('toggle-equitable');
            const btnSimple = document.getElementById('toggle-simple');
            
            btnEquitable.addEventListener('click', () => {
                acquisitionMode = 'equitable';
                btnEquitable.classList.add('active');
                btnSimple.classList.remove('active');
                updateUI();
            });

            btnSimple.addEventListener('click', () => {
                acquisitionMode = 'simple';
                btnSimple.classList.add('active');
                btnEquitable.classList.remove('active');
                updateUI();
            });
            
            // Initial call
            updateUI();

            // Handle details/summary toggle animation
            document.querySelectorAll('details').forEach((detail) => {
                detail.addEventListener('toggle', (event) => {
                    const summary = detail.querySelector('summary');
                    const arrow = summary.querySelector('span:last-child');
                    if (detail.open) {
                        arrow.style.transform = 'rotate(90deg)';
                    } else {
                        arrow.style.transform = 'rotate(0deg)';
                    }
                });
            });

        });
    </script>
</body>
</html>
